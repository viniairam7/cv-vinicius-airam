<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dia com Deus â€” Planner</title>

  <!-- Fonte limpa e moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* MOBILE FIRST - Minimalista inspirado no Gemini */
    :root{
      --bg: #070708;
      --card: #121214;
      --muted: #9a9a9a;
      --text: #ffffff;
      --accent: #3B82F6;
      --pill-radius: 14px;
      --gap: 18px;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg),#060606 60%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:24px 18px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }

    /* Header */
    .greet{
      margin-top:4px;
    }
    .hello{
      font-size:14px;
      color:var(--muted);
      margin:0 0 6px 0;
    }
    h1{
      margin:0;
      font-size:34px;
      line-height:1.02;
      font-weight:600;
      letter-spacing:-0.6px;
    }

    /* Input area */
    .input-card{
      background:rgba(255,255,255,0.02);
      border-radius:18px;
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow: 0 6px 22px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.03);
    }
    textarea{
      width:100%;
      min-height:110px;
      resize:none;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:16px;
      line-height:1.4;
      padding:6px 0;
    }
    textarea::placeholder{color:var(--muted);}

    .btn{
      appearance:none;
      -webkit-appearance:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px 18px;
      border-radius:16px;
      background:var(--card);
      color:var(--text);
      border:1px solid rgba(255,255,255,0.04);
      font-weight:600;
      cursor:pointer;
      font-size:15px;
    }
    .btn.primary{
      background:linear-gradient(180deg,var(--accent),#2563eb);
      color:white;
      border: none;
      box-shadow: 0 6px 18px rgba(59,130,246,0.18);
    }

    /* Sections */
    .section-title{
      margin:8px 0 6px 0;
      font-size:18px;
      font-weight:600;
    }
    .card{
      background:rgba(255,255,255,0.02);
      border-radius:16px;
      padding:14px;
      border:1px solid rgba(255,255,255,0.03);
      color:var(--text);
      font-size:15px;
    }
    .muted{
      color:var(--muted);
      font-size:14px;
    }

    /* pills for small items */
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(255,255,255,0.01);
      border:1px solid rgba(255,255,255,0.03);
      margin-right:8px;
      margin-bottom:8px;
      font-weight:500;
    }

    /* result lists */
    .list{display:flex;flex-direction:column;gap:10px;margin-top:10px;}
    .list .row{display:flex;gap:12px;align-items:flex-start;}
    .icon{
      width:36px;height:36px;border-radius:10px;display:inline-grid;place-items:center;background:rgba(255,255,255,0.02);font-size:18px;
    }

    footer{
      margin-top:auto;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }
    .save-muted{font-size:13px;color:var(--muted);}

    /* Responsive adjustments for larger screens */
    @media(min-width:720px){
      body{
        padding:34px 48px;
        max-width:820px;
        margin:0 auto;
      }
      h1{font-size:40px;}
      textarea{min-height:140px;}
    }
  </style>
</head>
<body>

  <header class="greet" aria-labelledby="welcome">
    <p class="hello" id="welcome">OlÃ¡, <span id="userNameDisplay">Vinicius</span></p>
    <h1>O que temos para hoje?</h1>
  </header>

  <!-- Input card -->
  <main>
    <section class="input-card" aria-label="Entrada do dia">
      <textarea id="dayInput" placeholder="Conte como serÃ¡ o seu dia de hoje... (ex: acordo Ã s 7h, trabalho das 9h Ã s 17h, almoÃ§o 12h, estudo Ã s 20h)"></textarea>

      <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn primary" id="generateBtn" title="Gerar planejamento do dia">âœ¨ Gerar meu dia com Deus</button>
        <button class="btn" id="clearBtn" title="Limpar">Limpar</button>
        <div style="flex:1"></div>
        <button class="btn" id="saveBtn" title="Salvar localmente">Salvar</button>
      </div>
    </section>

    <!-- Results -->
    <section>
      <h2 class="section-title">Resumo do seu dia</h2>
      <div class="card" id="summaryCard">Nenhuma entrada ainda â€” escreva seu dia e toque em "Gerar".</div>

      <h2 class="section-title">Melhores horÃ¡rios para orar</h2>
      <div class="card" id="prayCard"><span class="muted">Sem sugestÃµes â€” gere seu dia.</span></div>

      <h2 class="section-title">SugestÃ£o de leitura bÃ­blica</h2>
      <div class="card" id="bibleCard"><span class="muted">Sem sugestÃµes â€” gere seu dia.</span></div>

      <h2 class="section-title">Plano do dia (cronograma)</h2>
      <div class="card" id="planCard"><span class="muted">Sem plano â€” gere seu dia.</span></div>
    </section>
  </main>

  <footer>
    <div class="save-muted">Projeto local â€” sem backend â€¢ Mobile first</div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button class="btn" id="shareBtn" title="Copiar plano">Copiar plano</button>
      <button class="btn" id="resetBtn" title="Resetar plano salvo">Resetar</button>
    </div>
  </footer>

  <script>
    /************************************************************************
     * Minimal offline planner logic (100% frontend)
     *
     * O que faz:
     * - Tenta extrair horÃ¡rios do texto (ex: "7h", "07:30", "Ã s 7", "Ã s 7h30")
     * - Gera 3 sugestÃµes de oraÃ§Ã£o (manhÃ£, almoÃ§o/intervalo, noite) baseadas na rotina
     * - Gera sugestÃ£o de leitura bÃ­blica e trecho breve (devocional curto)
     * - Monta um plano cronolÃ³gico simples
     * - Salva/recupera do localStorage
     ************************************************************************/

    // elementos
    const dayInput = document.getElementById('dayInput');
    const generateBtn = document.getElementById('generateBtn');
    const summaryCard = document.getElementById('summaryCard');
    const prayCard = document.getElementById('prayCard');
    const bibleCard = document.getElementById('bibleCard');
    const planCard = document.getElementById('planCard');
    const saveBtn = document.getElementById('saveBtn');
    const shareBtn = document.getElementById('shareBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resetBtn = document.getElementById('resetBtn');

    const STORAGE_KEY = 'diaComDeus.plan';

    // exemplos de leituras + devocionais curtos
    const readings = [
      { ref: "Salmo 23", text: "O Senhor Ã© o meu pastor; nada me faltarÃ¡. Medite na presenÃ§a e provisÃ£o de Deus."},
      { ref: "Mateus 6:33", text: "Buscai primeiro o Reino de Deus e a sua justiÃ§a. Priorize tempo com Ele."},
      { ref: "Filipenses 4:6-7", text: "NÃ£o andeis ansiosos; apresentem tudo em oraÃ§Ã£o. A paz de Deus guardarÃ¡ o seu coraÃ§Ã£o."},
      { ref: "Salmo 91", text: "Confie na proteÃ§Ã£o de Deus. Uma leitura para renovar confianÃ§a e paz."},
      { ref: "Romanos 12:12", text: "Alegrem-se na esperanÃ§a, sejam pacientes na tribulaÃ§Ã£o e perseverem na oraÃ§Ã£o."}
    ];

    // util: extrair horÃ¡rios do texto (retorna array de objetos {timeStr, minutes})
    function extractTimes(text){
      const times = [];
      if(!text) return times;
      // padrÃµes: 7h, 7h30, 07:30, 7:00, Ã s 7, as 7h
      const re = /(?:Ã s|as)?\s*([0-2]?\d)(?:h|:)?([0-5]?\d)?/gi;
      let match;
      while((match = re.exec(text)) !== null){
        let hour = parseInt(match[1],10);
        let min = match[2] ? parseInt(match[2],10) : 0;
        // sanitize
        if(hour >= 24) continue;
        times.push({
          timeStr: pad(hour) + ':' + pad(min),
          minutes: hour*60 + min
        });
      }
      // tambÃ©m tentar padrÃµes como "manhÃ£", "noite", "tarde"
      // retornar unique by minutes
      const uniq = [];
      const seen = new Set();
      times.forEach(t=>{
        if(!seen.has(t.minutes)){
          seen.add(t.minutes);
          uniq.push(t);
        }
      });
      // sort
      uniq.sort((a,b)=>a.minutes-b.minutes);
      return uniq;
    }

    function pad(n){ return n.toString().padStart(2,'0'); }

    // escolhe os melhores horÃ¡rios para orar considerando rotina
    function suggestPrayerTimes(parsedTimes){
      // heurÃ­stica simples:
      // - se detectou horÃ¡rio de acordar (< 10:00), usar esse + depois um meio-dia + um Ã  noite
      const suggestions = [];
      const now = new Date();
      // default guess
      const morning = parsedTimes.length ? parsedTimes[0].minutes : 7*60; // 7:00
      const noon = 12*60;
      const night = 21*60;

      // se o morning muito tarde (>10h), ajustar
      let m = morning;
      if(m > 10*60) m = 9*60;

      suggestions.push({label: 'ManhÃ£ (reflexÃ£o curta)', time: minutesToTime(m), reason: 'Momento introdutÃ³rio para comeÃ§ar o dia em oraÃ§Ã£o.'});
      // escolher um horÃ¡rio no meio do expediente se existir um range
      suggestions.push({label: 'Intervalo/AlmoÃ§o', time: minutesToTime(noon), reason: 'Pausa ideal para recarregar e orar.'});
      // noite
      suggestions.push({label: 'Noite (acalma e agradece)', time: minutesToTime(night), reason: 'Momento de agradecer e encerrar o dia com Deus.'});

      // se houver um horÃ¡rio de estudo/atividades que conflite, tentar evitar (simples heurÃ­stica)
      return suggestions;
    }

    function minutesToTime(mins){
      const h = Math.floor(mins/60);
      const m = mins % 60;
      return pad(h) + ':' + pad(m);
    }

    // gerar plano cronolÃ³gico simples
    function generatePlan(parsedTimes, text){
      // heurÃ­stica simples: extrair eventos simples por frases (separadas por vÃ­rgula ou 'e')
      const parts = text.split(/[,.;]\s*| e /i).map(s=>s.trim()).filter(Boolean);
      const plan = [];
      // se tempos extraÃ­dos, tentar associar
      let times = parsedTimes.slice();
      // fallback times if none: 07:00, 09:00, 12:00, 18:00, 20:00
      const fallbackTimes = [7*60,9*60,12*60,18*60,20*60];
      let fallbackIdx = 0;

      parts.forEach((p, idx)=>{
        let assignedTime = null;
        // if phrase contains a time, pick the earliest remaining
        // else use fallback
        if(times.length){
          assignedTime = times.shift().timeStr;
        } else {
          assignedTime = minutesToTime(fallbackTimes[Math.min(fallbackIdx, fallbackTimes.length-1)]);
          fallbackIdx++;
        }
        plan.push({time: assignedTime, text: capitalize(p)});
      });

      // ensure there is a prayer / reading inserted
      plan.push({time: minutesToTime(12*60), text: 'Intervalo para oraÃ§Ã£o â€” 5 a 10 minutos (pausa do dia)'});
      plan.push({time: minutesToTime(21*60), text: 'Leitura bÃ­blica curta â€” 10 minutos'});

      // sort by time
      plan.sort((a,b)=>timeToMinutes(a.time) - timeToMinutes(b.time));
      return plan;
    }

    function timeToMinutes(t){
      const [h,m] = t.split(':').map(Number);
      return h*60 + (m||0);
    }

    function capitalize(s){
      if(!s) return s;
      return s[0].toUpperCase() + s.slice(1);
    }

    // escolha aleatÃ³ria de leitura
    function pickReading(){
      return readings[Math.floor(Math.random()*readings.length)];
    }

    // montar saÃ­da visual
    function renderAll(text){
      const parsed = extractTimes(text);
      // resumo
      summaryCard.innerHTML = text ? escapeHtml(text) : '<span class="muted">Nenhuma entrada ainda â€” escreva seu dia e toque em "Gerar".</span>';

      // oraÃ§Ãµes
      const prayers = suggestPrayerTimes(parsed);
      prayCard.innerHTML = '';
      const prayList = document.createElement('div');
      prayList.className = 'list';
      prayers.forEach(p => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div class="icon">ðŸ•Š</div>
          <div style="flex:1">
            <div style="font-weight:600">${p.label} â€¢ ${p.time}</div>
            <div class="muted" style="margin-top:6px;">${escapeHtml(p.reason)}</div>
          </div>
        `;
        prayList.appendChild(row);
      });
      prayCard.appendChild(prayList);

      // leitura bÃ­blica
      const reading = pickReading();
      bibleCard.innerHTML = `
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div class="icon">ðŸ“–</div>
          <div style="flex:1">
            <div style="font-weight:600">${reading.ref}</div>
            <div class="muted" style="margin-top:6px;">${escapeHtml(reading.text)}</div>
          </div>
        </div>
      `;

      // plano
      const plan = generatePlan(parsed, text || '');
      planCard.innerHTML = '';
      const planList = document.createElement('div');
      planList.className = 'list';
      plan.forEach(item=>{
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div style="width:68px;font-weight:700">${item.time}</div>
          <div style="flex:1">${escapeHtml(item.text)}</div>
        `;
        planList.appendChild(row);
      });
      planCard.appendChild(planList);

      // retorna objeto para possÃ­vel uso
      return {parsed, prayers, reading, plan};
    }

    // helper: escape HTML to prevent injection from user input
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, function(m){
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
      });
    }

    // salvar no localStorage
    function savePlanToStorage(obj){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
        flashMessage('Plano salvo localmente.');
      }catch(e){
        flashMessage('Erro ao salvar.');
      }
    }
    // carregar do storage
    function loadPlanFromStorage(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      try{
        return JSON.parse(raw);
      }catch(e){
        return null;
      }
    }
    // limpar storage
    function resetStorage(){
      localStorage.removeItem(STORAGE_KEY);
      flashMessage('Plano resetado.');
    }

    function flashMessage(msg){
      // mensagem rÃ¡pida visual (simples)
      const el = document.createElement('div');
      el.textContent = msg;
      el.style.position='fixed';
      el.style.left='50%';
      el.style.transform='translateX(-50%)';
      el.style.bottom='26px';
      el.style.background='rgba(0,0,0,0.7)';
      el.style.color='white';
      el.style.padding='10px 14px';
      el.style.borderRadius='10px';
      el.style.zIndex=9999;
      document.body.appendChild(el);
      setTimeout(()=>el.style.opacity='0',1400);
      setTimeout(()=>el.remove(),2000);
    }

    // compartilhar (copiar plano)
    function copyPlanText(obj){
      // montar texto simples
      const lines = [];
      lines.push('Plano â€” Dia com Deus');
      lines.push('Resumo:');
      lines.push((obj.summary || '').trim());
      lines.push('');
      lines.push('HorÃ¡rios sugeridos para orar:');
      (obj.prayers || []).forEach(p=>lines.push(` - ${p.label} ${p.time} â€” ${p.reason}`));
      lines.push('');
      lines.push('Leitura sugerida:');
      if(obj.reading) lines.push(` - ${obj.reading.ref} â€” ${obj.reading.text}`);
      lines.push('');
      lines.push('Cronograma:');
      (obj.plan || []).forEach(it=>lines.push(` ${it.time} â€” ${it.text}`));
      const text = lines.join('\n');
      navigator.clipboard?.writeText(text).then(()=>flashMessage('Plano copiado para a Ã¡rea de transferÃªncia.')).catch(()=>flashMessage('Falha ao copiar.'));
    }

    // evento generate
    generateBtn.addEventListener('click', ()=>{
      const text = dayInput.value.trim();
      if(!text){
        flashMessage('Escreva algo sobre seu dia primeiro.');
        return;
      }
      const result = renderAll(text);
      // montar objeto para salvar
      const payload = {
        createdAt: new Date().toISOString(),
        summary: text,
        parsed: result.parsed,
        prayers: result.prayers,
        reading: result.reading,
        plan: result.plan
      };
      // auto salvar
      savePlanToStorage(payload);
    });

    // save button
    saveBtn.addEventListener('click', ()=>{
      const text = dayInput.value.trim();
      const existing = renderAll(text);
      const payload = {
        createdAt: new Date().toISOString(),
        summary: text,
        parsed: existing.parsed,
        prayers: existing.prayers,
        reading: existing.reading,
        plan: existing.plan
      };
      savePlanToStorage(payload);
    });

    // share
    shareBtn.addEventListener('click', ()=>{
      const raw = loadPlanFromStorage();
      if(!raw){
        flashMessage('Nenhum plano salvo para copiar.');
        return;
      }
      copyPlanText(raw);
    });

    // clear input
    clearBtn.addEventListener('click', ()=>{
      dayInput.value = '';
      summaryCard.innerHTML = 'Nenhuma entrada ainda â€” escreva seu dia e toque em "Gerar".';
      prayCard.innerHTML = '<span class="muted">Sem sugestÃµes â€” gere seu dia.</span>';
      bibleCard.innerHTML = '<span class="muted">Sem sugestÃµes â€” gere seu dia.</span>';
      planCard.innerHTML = '<span class="muted">Sem plano â€” gere seu dia.</span>';
    });

    // reset
    resetBtn.addEventListener('click', ()=>{
      resetStorage();
      clearBtn.click();
    });

    // on load, try to restore
    window.addEventListener('load', ()=>{
      const raw = loadPlanFromStorage();
      if(raw){
        // restore the summary into textarea
        dayInput.value = raw.summary || '';
        renderAll(raw.summary || '');
        flashMessage('Plano restaurado localmente.');
      }
    });

    // small utility to allow pressing CMD/CTRL+Enter to generate
    dayInput.addEventListener('keydown', (e)=>{
      if((e.key === 'Enter' && (e.metaKey || e.ctrlKey))){
        e.preventDefault();
        generateBtn.click();
      }
    });

  </script>
</body>
</html>